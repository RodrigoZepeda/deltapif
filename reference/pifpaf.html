<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Potential Impact fraction and Population Attributable Fraction — pifpaf • deltapif</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Potential Impact fraction and Population Attributable Fraction — pifpaf"><meta name="description" content="Calculates the potential impact fraction pif or the population
attributable fraction paf for a categorical exposure considering
an observed prevalence of  p and a relative risk
(or relative risk parameter) of beta."><meta property="og:description" content="Calculates the potential impact fraction pif or the population
attributable fraction paf for a categorical exposure considering
an observed prevalence of  p and a relative risk
(or relative risk parameter) of beta."><meta property="og:image" content="https://rodrigozepeda.github.io/deltapif/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">deltapif</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Examples.html">Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Potential Impact fraction and Population Attributable Fraction</h1>

      <div class="d-none name"><code>pifpaf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the potential impact fraction <code>pif</code> or the population
attributable fraction <code>paf</code> for a categorical exposure considering
an observed prevalence of  <code>p</code> and a relative risk
(or relative risk parameter) of <code>beta</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">paf</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  <span class="va">beta</span>,</span>
<span>  var_p <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_beta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rr_link <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  rr_link_deriv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"log-complement"</span>,</span>
<span>  link_inv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  link_deriv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pif</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  p_cft <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="length.html">length</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">beta</span>,</span>
<span>  var_p <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_beta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rr_link <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  rr_link_deriv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"log-complement"</span>,</span>
<span>  link_inv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  link_deriv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"PIF"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>Prevalence (proportion) of the exposed individuals for
each of the <code>N</code> exposure levels.</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>Relative risk parameter for which standard deviation is
available (usually its either the relative risk directly or the log
of the relative risk as most RRs, ORs and HRs come from exponential
models).</p></dd>


<dt id="arg-var-p">var_p<a class="anchor" aria-label="anchor" href="#arg-var-p"></a></dt>
<dd><p>Estimate of the link_covariance matrix of <code>p</code> where the entry
<code>var_p[i,j]</code> represents the link_covariance between <code>p[i]</code> and <code>p[j]</code>.</p></dd>


<dt id="arg-var-beta">var_beta<a class="anchor" aria-label="anchor" href="#arg-var-beta"></a></dt>
<dd><p>Estimate of the link_covariance matrix of <code>beta</code> where the entry
<code>var_beta[i,j]</code> represents the link_covariance between <code>beta[i]</code> and <code>beta[j]</code>.</p></dd>


<dt id="arg-rr-link">rr_link<a class="anchor" aria-label="anchor" href="#arg-rr-link"></a></dt>
<dd><p>Link function such that the relative risk is given by
<code>rr_link(beta)</code>.</p></dd>


<dt id="arg-rr-link-deriv">rr_link_deriv<a class="anchor" aria-label="anchor" href="#arg-rr-link-deriv"></a></dt>
<dd><p>Derivative of the link function for the relative risk.
The function tries to build it automatically from <code>rr_link</code> using
<code><a href="https://rdrr.io/pkg/Deriv/man/Deriv.html" class="external-link">Deriv::Deriv()</a></code>.</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>Link function such that the <code>pif</code> confidence intervals
stays within the expected bounds.</p></dd>


<dt id="arg-link-inv">link_inv<a class="anchor" aria-label="anchor" href="#arg-link-inv"></a></dt>
<dd><p>(Optional). If <code>link</code> is a function then
yhe inverse of <code>link</code>. For example if <code>link</code> is <code>logit</code> this
should be <code>inv_logit</code>.</p></dd>


<dt id="arg-link-deriv">link_deriv<a class="anchor" aria-label="anchor" href="#arg-link-deriv"></a></dt>
<dd><p>Derivative of the <code>link</code> function. The function tries
to build it automatically from <code>link</code> using <code><a href="https://rdrr.io/pkg/Deriv/man/Deriv.html" class="external-link">Deriv::Deriv()</a></code>.</p></dd>


<dt id="arg-conf-level">conf_level<a class="anchor" aria-label="anchor" href="#arg-conf-level"></a></dt>
<dd><p>Confidence level for the confidence interval (default 0.95).</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Whether to show messages.</p></dd>


<dt id="arg-label">label<a class="anchor" aria-label="anchor" href="#arg-label"></a></dt>
<dd><p>Character identifier for the impact fraction. This is for</p></dd>


<dt id="arg-p-cft">p_cft<a class="anchor" aria-label="anchor" href="#arg-p-cft"></a></dt>
<dd><p>Counterfactual prevalence (proportion) of the exposed
individuals for each of the <code>N</code> exposure levels.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Character either Potential Impact Fraction (<code>PIF</code>) or
Population Attributable Fraction (<code>PAF</code>)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function assumes <code>p</code> and <code>beta</code> have been pre-computed from
the data and the individual-level data are not accessible to the
researchers. If either the data for the individual-level prevalence of
exposure <code>p</code> or the data for the individual-level risk estimate <code>beta</code>
can be accessed by the researcher other methods (such as the <code>pifpaf</code>
package should be preferred).</p>
    </div>
    <div class="section level2">
    <h2 id="formulas">Formulas<a class="anchor" aria-label="anchor" href="#formulas"></a></h2>


<p>This function computed the potential impact fraction and its confidence
intervals using Walter's formula:</p>
<p>$$
\textrm{PIF} =
 \dfrac{
   \sum\limits_{i=1}^N p_i \text{RR}_i -
   \sum\limits_{i=1}^N p_i^{\text{cft}} \text{RR}_i
  }{
   \sum\limits_{i=1}^N p_i \text{RR}_i
  }, \quad \text{ and } \quad
\textrm{PAF} =
 \dfrac{
   \sum\limits_{i=1}^N p_i \text{RR}_i - 1
  }{
   \sum\limits_{i=1}^N p_i \text{RR}_i
  }
$$</p>
<p>in the case of <code>N</code> exposure categories which is equivalent to Levine's
formula when there is only <code>1</code> exposure category:</p>
<p>$$
\textrm{PIF} =
 \dfrac{
   p (\text{RR} - 1) - p^{\text{cft}} (\text{RR} - 1)
  }{
   1 + p (\text{RR} - 1)
  }
  \quad \textrm{ and } \quad
\textrm{PAF} =
 \dfrac{
   p (\text{RR} - 1)
  }{
   1 + p (\text{RR} - 1)
  }
$$</p>
<p>The construction of confidence intervals is done via a link function. Its
variance is given by:</p>
<p>$$
\sigma_f^2 = \text{Var}\Big[ f(\textrm{PIF}) \Big] \approx
\Big(f'(\textrm{PIF})\Big)^2 \text{Var}\Big[ \textrm{PIF} \Big]
$$
and the intervals are constructed as:
$$
\text{CI} = f^{-1}\Big(  f(\textrm{PIF})  \pm Z_{\alpha/2} \cdot \sigma_f \Big)
$$</p>
<p>the function \(f\) is called the link function for the PIF, \(f^{-1}\)
represents its inverse, and \(f'\) its derivative.</p>
    </div>
    <div class="section level2">
    <h2 id="link-functions-for-the-pif">Link functions for the PIF<a class="anchor" aria-label="anchor" href="#link-functions-for-the-pif"></a></h2>



<p>By default the <code>pif</code> and <code>paf</code> calculations use the <code>log-complement</code> link
which guarantees the impact fractions' intervals have valid values
(between <code>-Inf</code> and <code>1</code>).</p>
<p>Depending on the application the following link functions are also
implemented:</p>
<dl><dt>log-complement</dt>
<dd><p>To achieve fractions between <code>-Inf</code> and <code>1</code>. This is
the function <code>f(x) = ln(1 - x)</code> with inverse <code>finv(x) = 1 - exp(x)</code></p></dd>

<dt>logit</dt>
<dd><p>To achieve strictly positive fractions between <code>0</code> and <code>1</code>.
This is the function <code>f(x) = ln(x / (1 - x))</code> with inverse
<code>finv(x) = 1 / (1 + exp(-x))</code></p></dd>

<dt>identity</dt>
<dd><p>An approximation for fractions that does not guarantee
confidence intervals in valid regions. This is the function
<code>f(x) = x</code>.with inverse <code>finv(x) = x</code></p></dd>

<dt>hawkins</dt>
<dd><p>Hawkins' fraction for controlling the variance. This is the
function <code>f(x) = ln(x + sqrt(x^2 + 1))</code> with inverse
<code>finv(x) = 0.5 * exp(-x) * (exp(2 * x) - 1)</code></p></dd>

<dt>custom</dt>
<dd><p>User specified (see below).</p></dd>


</dl><p>In general, <code>logit</code> should be preferred if it is known and certain that the
fractions can only be positive (i.e. when all relative risks (including CIs)
are &gt; 1 and prevalence &gt; 0 and there is an epidemiological / biological
justification).</p>
<p><strong>Custom link</strong> functions can be implemented as long as they are invertible
in the range of interest by providing:</p><dl><dt>link</dt>
<dd><p>The function</p></dd>

<dt>link_inv</dt>
<dd><p>The inverse function of <code>link</code></p></dd>

<dt>link_deriv</dt>
<dd><p>The derivative of <code>link</code></p></dd>


</dl><p>If no derivative is provided the package attempts to estimate it
symbolically using <code><a href="https://rdrr.io/pkg/Deriv/man/Deriv.html" class="external-link">Deriv::Deriv()</a></code> however there is no guarantee that this
will work for non-standard functions (i.e. not logarithm / trigonometric /
exponential)</p>
<p>As an example considering implementing a square root custom link:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># The link is square root</span></span>
<span><span class="va">link</span>      <span class="op">&lt;-</span> <span class="va">sqrt</span></span>
<span></span>
<span><span class="co"># Inverse of sqrt(x) is x^2</span></span>
<span><span class="va">link_inv</span>  <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># The derivative of sqrt(x) is 1/(2 * sqrt(x))</span></span>
<span><span class="va">link_deriv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pif</span><span class="op">)</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">pif</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then the pif can be calculated as:</span></span>
<span><span class="fu"><a href="../reference/pifpaf.html">pif</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.499</span>, beta <span class="op">=</span> <span class="fl">1.6</span>, p_cft <span class="op">=</span> <span class="fl">0.499</span><span class="op">/</span><span class="fl">2</span>, var_p <span class="op">=</span> <span class="fl">0.1</span>, var_beta <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>     link <span class="op">=</span> <span class="va">link</span>, link_inv <span class="op">=</span> <span class="va">link_inv</span>, link_deriv <span class="op">=</span> <span class="va">link_deriv</span><span class="op">)</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="link-functions-for-beta">Link functions for beta<a class="anchor" aria-label="anchor" href="#link-functions-for-beta"></a></h2>



<p>By default the <code>pif</code> and <code>paf</code> use the <code>exponential</code> link which means that
the values for <code>beta</code> are the log-relative risks and the
variance <code>var_beta</code> corresponds to the log-relative risk's variance.
Depending on the relative risk's source the following options are available:</p>
<dl><dt>exponential</dt>
<dd><p>For when the relative risks correspond to the
exponential of another parameter, usually called <code>beta</code>. This is
the exponential function <code>f(beta) = exp(beta)</code> with inverse
<code>finv(rr) = log(rr) = beta</code></p></dd>

<dt>identity</dt>
<dd><p>For when the relative risk and their variance are
reported directly. This is the function <code>f(beta) = beta</code>
with inverse <code>finv(rr) = rr = beta</code></p></dd>

<dt>custom</dt>
<dd><p>User specified (see below).</p></dd>


</dl><p><strong>Note</strong> that in most cases including contingency tables, Poisson and
Logistic regressions, and Cox Proportional Hazards, the relative risks are
estimated by exponentiating a parameter.</p>
<p>As in the previous section, custom link functions for beta can be implemented
as long as they are invertible in the range of interest by providing the
function <code>rr_link</code> and its derivative <code>rr_link_deriv</code>. If no derivative
is provided the package does an attempt to estimate it symbolically
using <code><a href="https://rdrr.io/pkg/Deriv/man/Deriv.html" class="external-link">Deriv::Deriv()</a></code> however there is no guarantee that this
will work non-standard functions (i.e. not logarithm / trigonometric /
exponential)</p>
    </div>
    <div class="section level2">
    <h2 id="population-attributable-fraction">Population Attributable Fraction<a class="anchor" aria-label="anchor" href="#population-attributable-fraction"></a></h2>



<p>The population attributable fraction corresponds to the potential impact
fraction at the theoretical minimum risk level. It is assumed that the
theoretical minimum risk level is a relative risk of 1. If no
counterfactual prevalence <code>p_cft</code> is specified, the model computes
the population attributable fraction.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="totalpifpaf.html">pif_total()</a></code>, <code><a href="totalpifpaf.html">pif_ensemble()</a></code>, <code><a href="totalpifpaf.html">paf_total()</a></code>, <code><a href="totalpifpaf.html">paf_ensemble()</a></code>,</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#EXAMPLE 1: ONE EXPOSURE CATEGORY (CLASSIC LEVIN)</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co"># This example comes from Levin 1953</span></span></span>
<span class="r-in"><span><span class="co"># Relative risk of lung cancer given smoking was 3.6</span></span></span>
<span class="r-in"><span><span class="co"># Proportion of individuals smoking where 49.9%</span></span></span>
<span class="r-in"><span><span class="co"># Calculates PAF (i.e. counterfactual is no smoking)</span></span></span>
<span class="r-in"><span><span class="fu">paf</span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.499</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">3.6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Assuming parameters `p` have no variance Use `var_p` to input their link_variances and/or covariance</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Assuming parameters `beta` have no variance Use `var_beta` to input their link_variances and/or covariance</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Population Attributable Fraction: </span><span style="font-weight: bold; font-style: italic;">[deltapif-112383884326229]</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PAF = 56.473% [<span style="font-style: italic;">95% CI</span>: 56.473% to 56.473%]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> standard_deviation(paf %) = 0.000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assuming that beta and p had a link_variance</span></span></span>
<span class="r-in"><span><span class="fu">paf</span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.499</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">3.6</span><span class="op">)</span>, var_p <span class="op">=</span> <span class="fl">0.001</span>, var_beta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Population Attributable Fraction: </span><span style="font-weight: bold; font-style: italic;">[deltapif-0397001493059625]</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PAF = 56.473% [<span style="font-style: italic;">95% CI</span>: 28.972% to 73.326%]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> standard_deviation(paf %) = 10.875</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If the link_variance was to high a logistic transform would be required</span></span></span>
<span class="r-in"><span><span class="co"># Generates incorrect values for the interval:</span></span></span>
<span class="r-in"><span><span class="fu">paf</span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.499</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">3.6</span><span class="op">)</span>, var_p <span class="op">=</span> <span class="fl">0.1</span>, var_beta <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Population Attributable Fraction: </span><span style="font-weight: bold; font-style: italic;">[deltapif-0823261150567127]</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PAF = 56.473% [<span style="font-style: italic;">95% CI</span>: -29.969% to 85.422%]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> standard_deviation(paf %) = 24.294</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Logit fixes it</span></span></span>
<span class="r-in"><span><span class="fu">paf</span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.499</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">3.6</span><span class="op">)</span>, var_p <span class="op">=</span> <span class="fl">0.1</span>, var_beta <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>    link <span class="op">=</span> <span class="st">"logit"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Population Attributable Fraction: </span><span style="font-weight: bold; font-style: italic;">[deltapif-05788846247121]</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PAF = 56.473% [<span style="font-style: italic;">95% CI</span>: 15.753% to 90.002%]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> standard_deviation(paf %) = 24.294</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If the counterfactual was reducing the smoking population by 1/2</span></span></span>
<span class="r-in"><span><span class="fu">pif</span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.499</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">3.6</span><span class="op">)</span>, p_cft <span class="op">=</span> <span class="fl">0.499</span><span class="op">/</span><span class="fl">2</span>, var_p <span class="op">=</span> <span class="fl">0.001</span>,</span></span>
<span class="r-in"><span>    var_beta <span class="op">=</span> <span class="fl">0.1</span>, link <span class="op">=</span> <span class="st">"logit"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Potential Impact Fraction: </span><span style="font-weight: bold; font-style: italic;">[deltapif-17637893775715]</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PIF = 28.236% [<span style="font-style: italic;">95% CI</span>: 18.101% to 41.192%]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> standard_deviation(pif %) = 5.963</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#EXAMPLE 2: MULTIPLE EXPOSURE CATEGORIES</span></span></span>
<span class="r-in"><span><span class="co">#---------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">#In "Excess Deaths Associated With Underweight, Overweight, and Obesity"</span></span></span>
<span class="r-in"><span><span class="co">#the PAF of mortality associated to different BMI levels is calculated</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#These are the relative risks for age-group 25-59 for each BMI level:</span></span></span>
<span class="r-in"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;18.5"</span> <span class="op">=</span> <span class="fl">1.38</span>, <span class="st">"25 to &lt;30"</span> <span class="op">=</span> <span class="fl">0.83</span> ,</span></span>
<span class="r-in"><span>        <span class="st">"30 to &lt;35"</span> <span class="op">=</span> <span class="fl">1.20</span>, <span class="st">"&gt;=35"</span> <span class="op">=</span> <span class="fl">1.83</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#While the prevalences are:</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;18.5"</span> <span class="op">=</span> <span class="fl">1.9</span>, <span class="st">"25 to &lt;30"</span> <span class="op">=</span> <span class="fl">34.8</span>,</span></span>
<span class="r-in"><span>        <span class="st">"30 to &lt;35"</span> <span class="op">=</span> <span class="fl">17.3</span>, <span class="st">"&gt;=35"</span> <span class="op">=</span> <span class="fl">13.3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#The variance of the relative risk is obtained from the CIs:</span></span></span>
<span class="r-in"><span><span class="va">var_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;18.5"</span> <span class="op">=</span> <span class="fl">0.2653156</span>, <span class="st">"25 to &lt;30"</span> <span class="op">=</span>  <span class="fl">0.1247604</span>,</span></span>
<span class="r-in"><span>                <span class="st">"30 to &lt;35"</span> <span class="op">=</span> <span class="fl">0.1828293</span>, <span class="st">"&gt;=35"</span> <span class="op">=</span> <span class="fl">0.1847374</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Note that we are omitting the group "18.5 to &lt; 25" as it is the</span></span></span>
<span class="r-in"><span><span class="co">#reference (RR = 1)</span></span></span>
<span class="r-in"><span><span class="fu">paf</span><span class="op">(</span>p <span class="op">=</span> <span class="va">p</span>, beta <span class="op">=</span> <span class="va">rr</span>, var_beta <span class="op">=</span> <span class="va">var_log_rr</span>, var_p <span class="op">=</span> <span class="fl">0</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Population Attributable Fraction: </span><span style="font-weight: bold; font-style: italic;">[deltapif-0132992146404077]</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PAF = 61.599% [<span style="font-style: italic;">95% CI</span>: 50.274% to 71.792%]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> standard_deviation(paf %) = 5.571</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#We can compute a potential impact fraction of, for example, reducing the</span></span></span>
<span class="r-in"><span><span class="co">#amount of people over 35 to 0 and having them in the "30 to &lt;35":</span></span></span>
<span class="r-in"><span><span class="va">p_cft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;18.5"</span> <span class="op">=</span> <span class="fl">1.9</span>, <span class="st">"25 to &lt;30"</span> <span class="op">=</span> <span class="fl">34.8</span>,</span></span>
<span class="r-in"><span>            <span class="st">"30 to &lt;35"</span> <span class="op">=</span> <span class="fl">17.3</span> <span class="op">+</span> <span class="fl">13.3</span>, <span class="st">"&gt;=35"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#The potential impact fraction is as follows:</span></span></span>
<span class="r-in"><span><span class="fu">pif</span><span class="op">(</span>p <span class="op">=</span> <span class="va">p</span>, p_cft <span class="op">=</span> <span class="va">p_cft</span>, beta <span class="op">=</span> <span class="va">rr</span>, link <span class="op">=</span> <span class="st">"logit"</span>,</span></span>
<span class="r-in"><span>  var_beta <span class="op">=</span> <span class="va">var_log_rr</span>, var_p <span class="op">=</span> <span class="fl">0</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Potential Impact Fraction: </span><span style="font-weight: bold; font-style: italic;">[deltapif-0376499328478288]</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PIF = 14.882% [<span style="font-style: italic;">95% CI</span>: 13.702% to 16.144%]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> standard_deviation(pif %) = 0.623</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rodrigo Zepeda-Tello.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

